require(OpenMx)   #Loads OpenMx
require(psych)   #Loads Psych package

library(devtools)
library(umx)
library (OpenMx)
library (haven)
library (dplyr)
library(car)
library(psych)
library(lme4)
library(nlme)
library(lmerTest)
library(ggplot2)
library(tidyverse)
library(lme4)
library(car)
library(multilevelTools)
source("GenEpiHelperFunctions.R")
source("polychoricMeansMatrix3.R")
library(haven)
library(JWileymisc)
library(effects)
library(sjPlot)
library(sjmisc)

#READ IN DATA; 
setwd("C:/Users/tyler/Lab Drive/ACTIVE/ACTIVE/ACTIVE/Data/Original")

ACTIVE <- read_sav("ACTIVE_LONG12302021.sav")
names(ACTIVE)
names(ACTIVE)<- toupper(names(ACTIVE))

#DATA DESCRIPTION;
#COGNITIVE VARIABLES ARE STANDARDIZED AND FOLLOW-UP SCORES ARE ADJUSTED FOR BASELINE SCORES SO THAT FOLLOW-UP SCORES REPRESENT DECLINE
#GENDER: MEN =1 AND WOMEN =2
#MARSTATE:  MARRIED/PARTNERED = 1 SINGLE/DIVORCED/WIDOWED = 0;
#EDUCLEVL
#CESD - 20 ITEM CENTER OF EPIDEMIOLOGICAL STUDIES - DEPRESSION SCALE
#BP = SF36 BODILY PAIN SCORE (ITEM 21) GREATER THAN 3 = 1, LESS THAN 4 = 0 (>3 = CLINICAL LEVELS OF PAIN); _B MEANS BASELINE; _NEW = INCIDENT PAIN AFTER BASELINE; 
#PBP = PERSISTENT BODILY PAIN DEFINED AS CLINICALLY SIGNIFICANT PAIN OCCURING AT TWO TIMEPOINTS CONSECUTIVELY (1 = YES; 0 = NO)

#DATA SELECTION; WE SELECTED THE CONTROL GROUP OF ACTIVE;  
ACTIVE.sub <- subset(ACTIVE, ACTIVE$INTGRPR==4)


#AGE_LONGC_TIMESINCE = Follow-up Age - Baseline Age; 
#BP_Sum = Total Years with Bodily Pain;
#BP_New = Incident Bodily Pain; 

#MLM MODELS;

model.MMSE <- lmer(ZMMSE ~  AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                     + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                     + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                   + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                     CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                     + (1| ID), ACTIVE.sub, REML=FALSE)  
summary(model.MMSE)

MMSE.mt<-modelTest(model.MMSE); MMSE.mt

model.HVLTT <- lmer(ZHVLTT ~   AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE) 
summary(model.HVLTT)

HVLTT.mt<-modelTest(model.HVLTT); HVLTT.mt

model.AVLTT <- lmer(ZAVLTT ~  AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE) 
summary(model.AVLTT)

AVLTT.mt<-modelTest(model.AVLTT); AVLTT.mt
model.IMMRAW <- lmer(ZIMMRAW ~  AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                       + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                       + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                     + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                       CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                       + (1| ID), sex.sub, REML=FALSE)  
summary(model.IMMRAW)

IMMRAW.mt<-modelTest(model.IMMRAW); IMMRAW.mt


model.DSCOR <- lmer(UFOV2R ~   AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
            + (1| ID), ACTIVE.sub, REML=FALSE)  
summary(model.DSCOR)

DSCOR.mt<-modelTest(model.DSCOR); DSCOR.mt

model.DCCOR <- lmer(ZMMSE ~  AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_LAST + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_LAST + GENDER_CAT*AGE_LONGC_LAST + EDUCLEVL*AGE_LONGC_LAST + CESD_B*AGE_LONGC_LAST 
                    + BP_B*AGE_LONGC_LAST + MARSTAT_CAT*AGE_LONGC_LAST +
                      CESDTOT*AGE_LONGC_LAST + BP_NEW*AGE_LONGC_LAST + BP_SUM*AGE_LONGC_LAST + 
                      + (1| ID), ACTIVE.sub, REML=FALSE)   
summary(model.DCCOR)

DCCOR.mt<-modelTest(model.DCCOR); DCCOR.mt

model.WSCOR <- lmer(ZWS_COR ~   AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + UFOV2 + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE)   
summary(model.WSCOR)

WSCOR.mt<-modelTest(model.WSCOR); WSCOR.mt



model.LSCOR <- lmer(ZLS_COR ~ AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE)
summary(model.LSCOR)

LSCOR.mt<-modelTest(model.LSCOR); LSCOR.mt


model.CRT <- lmer(ZCRT ~ AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                    + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                    + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                  + BP_B*AGE_LONGC_TIMESINCE + 
                    CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                    + (1| ID), ACTIVE.sub, REML=FALSE) 
summary(model.CRT)

CRT.mt<-modelTest(model.CRT); CRT.mt

model.UFOV2 <- lmer(ZUFOV2 ~   AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE)   
summary(model.UFOV2)



model.UFOV2 <- lmer(ZUFOV2 ~  AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_NEWB + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_NEWB*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE) 
summary(model.UFOV2)

UFOV2.mt<-modelTest(model.UFOV2); UFOV2.mt

model.UFOV3 <- lmer(ZUFOV3 ~ AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE) 
summary(model.UFOV3)

UFOV3.mt<-modelTest(model.UFOV3); UFOV3.mt

model.UFOV4 <- lmer(ZUFOV4 ~   AGEB + RACE_CAT + GENDER_CAT + EDUCLEVL + MARSTAT_CAT +  CESD_B + BP_B + 
                      + AGE_LONGC_TIMESINCE + BP_NEW +  BP_SUM + CESDTOT + 
                      + RACE_CAT*AGE_LONGC_TIMESINCE + GENDER_CAT*AGE_LONGC_TIMESINCE + EDUCLEVL*AGE_LONGC_TIMESINCE + CESD_B*AGE_LONGC_TIMESINCE 
                    + BP_B*AGE_LONGC_TIMESINCE + MARSTAT_CAT*AGE_LONGC_TIMESINCE +
                      CESDTOT*AGE_LONGC_TIMESINCE + BP_NEW*AGE_LONGC_TIMESINCE + BP_SUM*AGE_LONGC_TIMESINCE + 
                      + (1| ID), ACTIVE.sub, REML=FALSE)
summary(model.UFOV4)

UFOV4.mt<-modelTest(model.UFOV4); UFOV4.mt

